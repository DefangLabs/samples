services:
  ui:
    # uncomment to add your own domain
    # domainname: example.com
    build:
      context: ./ui
      dockerfile: Dockerfile
    ports:
      - target: 3000
        published: 3000
        mode: ingress
    deploy:
      resources:
        reservations:
          memory: 256M
    environment: 
      - ANTHROPIC_API_KEY
      - GIT_SERVER_URL=http://mcp-git-server:8000 # Add this line to configure the Git server URL
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/"]

  mcp-git-server:
    image: mcp/git:latest
    ports:
      - target: 8000
        published: 8000
        mode: ingress
    environment:
      - GIT_SERVER_URL=http://mcp-git-server:8000 # Add this line to configure the Git server URL
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]

  # ollama:
  #   # uncomment to add your own domain
  #   # domainname: example.com
  #   build:
  #     context: ./ollama
  #     dockerfile: Dockerfile
  #     shm_size: "16gb"
  #   ports:
  #     - target: 8000
  #       mode: host
  #   deploy:
  #     resources:
  #       reservations:
  #         cpus: '2.0'
  #         memory: 8192M
         
  #   # By Default we load llama3.2:1b because it can run efficiently on a CPU, but you can select
  #   # a different model by setting the LOAD_MODEL environment variable. Check the [list](https://ollama.com/library)
  #   # for more models. For example, to load gemma:7b, set the LOAD_MODEL environment variable to gemma:7b below.
  #   environment:
  #     - LOAD_MODEL=llama3.2:1b
  #     # - LOAD_MODEL=gemma:7b
  #   healthcheck:
  #     # wget or curl required for healthchecks on services with a published port
  #     # this gets parsed by Defang and provided to the load balancers as well
  #     test: [ "CMD", "curl", "-s", "http://localhost:8000/" ]
